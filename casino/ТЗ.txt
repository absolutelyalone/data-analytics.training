Задача: Если текущая дата в текущем месяце, то необходимо отобрать квалифицированных юзеров в прошлом месяце и проанализировать их поведение в текущем месяце на каждую дату текущего месяца за период с первого числа месяца по каждую дату текущего месяца.

Как определить квалифицированных пользователей:
1) Определяем по каждому юзеру показатель GGR (прошлом месяце) = сумма ставок в прошлом месяце по каждому пользователю - сумма выигрышей в прошлом месяце по каждому пользователю
2) Определяяем пользователей которые выполнили квалификацию GGR>N (N по умолчанию 500)

Необходимо посчитать показатель RR
1) в текущем месяце на каждый день месяца определяем показатель RR = Кол-во пользователей выполнивших в прошлом месяце квалицфикацию и которые от начала текущего месяца до даты текущего месяца уже выполнили квалификацию / Кол-во игроков выполнивших квалификацию в прошлом месяце * 100

Необходимо посчитать показатель CR
4) определяем CR = Кол-во игроков которые сделали хотя бы 1 депозит от начала текущего месяца до даты текущего месяца / Кол-во игроков выполнивших квалификацию в прошлом месяце * 100


в результате получается вот такой датафрейм c агрегацией

Месяц квалификации|Количичество квалифицированных|Скор квалификации|Дата текущего месяца|Выполнили квалификацию (RR)|Сделали 1 и более депозит (CR)
2022-01 |200 |500 |2022-02-01 |0.03 |0.07
2022-01 |200 |500 |2022-02-02 |0.05 |0.15
2022-01 |200 |500 |2022-02-03 |0.06 |0.21
2022-01 |200 |500 |2022-02-04 |0.07 |0.22
2022-01 |200 |500 |2022-02-05 |0.07 |0.25
2022-01 |200 |500 |2022-02-26 |0.03 |0.25

второй датафрейм с детализацией
Месяц квалификации|Скор квалификации|userId квалифицировавшегося|Дата текущего месяца|Выполнил квалификацию|Сделали 1 и более депозит
2022-01 |200 |171861715 |2022-02-01 |0 |1
2022-01 |200 |115058937 |2022-02-01 |1 |1
2022-01 |200 |115058938 |2022-02-01 |0 |1

...
2022-01 |200 |171861715 |2022-02-10 |1 |1


Отчет строится по текущему месяца до текущей даты, Группа квалифицированных исследуется в прошлом месяце, идущем до текущего.
т.е если сейчас 27.04.2023, то исследуем GGR март 2023, а аналитику строим ежедневно с 01.04.2023 до 26.04.2023


это OLAP датафрейм поэтому нужно не зыбвать избавляться от дублирующих записей.

op_id - id операции
user_id - id пользователя
type - тип операции (ставка или операция со счетом)
op_date - дата операции
amount - сумма операции в условных единицах

direction - направление операции
(type==deposit: in - пополнение, out вывод денег со счета)
(type==bet: in - вывод, out - ставка)